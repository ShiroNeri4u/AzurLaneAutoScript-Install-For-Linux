# Maintainer: Shiro_Neri(Shiro_Neri@iCloud.com)

pkgname=azurlane-autoscript-server
_pkgname=alas
_reponame=AzurLaneAutoScript
_git=$github
# For China User Ch
_github=https://github.com/
_gitee=https://gitee.com/
pkgver=dev
pkgrel=1
pkgdesc="Azur Lane bot with GUI (Supports CN, EN, JP, TW, able to support other servers)"
arch=(any)
url="$_git/LmeSzinc/$_reponame"
_mkurl="_git/ShiroNeri4u/$_reponame-Install-For-Linux"
license=('GPL3')
depends=('git' 'bash' 'miniconda3' 'android-tools')
source=("git+$url#branch=master"
        "git+$_mkurl#branch=master")
sha256sums=('SKIP'
            'SKIP')

prepare() {
    #!/bin/bash
    cp "$srcdir/$_reponame/config/deploy.template-AidLux-cn.yaml" "$srcdir/$_reponame/config/deploy.yaml"
    cd "$srcdir/$_reponame/"
    conda create -n alas python==3.7.6 -y
    conda clean -ay
    source /opt/miniconda3/bin/activate $HOME/.conda/envs/alas
    pip install -r requirements-in.txt
    rm -rf "$srcdir/$_reponame/.git"
    mkdir "$srcdir/$_reponame/.git"
    cp -rT "$srcdir/../$_reponame" "$srcdir/$_reponame/.git/"
    }

package() {
    mkdir -p "$pkgdir/opt/$_pkgname"
    mkdir -p "$pkgdir/usr/bin"
    cp -rT "$srcdir/$reponame/" "$pkgdir/opt/$_pkgname"
    install -Dm777 "$srcdir/$_reponame-Install-For-Linux/$_reponame-Server/alas" "$pkgdir/usr/bin/"
    install -Dm777 "$srcdir/$_reponame-Install-For-Linux/$_reponame-Server/alas-chmod" "$pkgdir/usr/bin/"
    install -Dm777 "$srcdir/$_reponame-Install-For-Linux/$_reponame-Server/alas-uninstall" "$pkgdir/usr/bin/"
    install -Dm644 "$srcdir/$_reponame/LICENSE" "$pkgdir/usr/share/licenses/$pkgname/LICENSE"
    }